# GigShield Agent Integration Guide

## ğŸ¯ Overview

This guide explains how the **Paralegal Agent** and **Eye Agent** work together to create a fully automated, AI-verified gig work platform.

## ğŸ”„ Complete Integration Flow

### Phase 1: Job Creation (Paralegal)

```
CLIENT
   â†“ submits description + photo
PARALEGAL AGENT
   â†“ validates & generates plan
SMART CONTRACT
   â†“ stores job + plan
JOB AVAILABLE TO WORKERS
```

### Phase 2: Work Verification (Eye)

```
WORKER
   â†“ submits proof photos
EYE AGENT
   â†“ fetches plan from contract
   â†“ verifies work
SMART CONTRACT
   â†“ releases payment if approved
WORKER GETS PAID
```

## ğŸ“Š Detailed Data Flow

### 1. Client Creates Job

**Input:**

```python
job_description = "Paint my bedroom wall blue at 123 Main St for 50 GAS"
reference_photo = image_bytes  # Current state of wall
```

**Paralegal Processing:**

```python
result = await analyze_job_request(job_description, reference_photo)

# Paralegal returns:
{
    "status": "complete",
    "data": {
        "task": "Paint bedroom wall blue",
        "location": "123 Main St",
        "price_amount": 50,
        "price_currency": "GAS"
    },
    "verification_plan": {
        "task_category": "painting",
        "expected_transformation": {
            "before": "unpainted or different colored wall",
            "after": "wall painted blue with clean finish"
        },
        "quality_indicators": [
            "even color coverage",
            "clean edges (no paint on ceiling/floor)",
            "no drips or runs",
            "smooth finish"
        ],
        "verification_checklist": [
            "Is it the same wall? (check features)",
            "Is color blue as specified?",
            "Are edges clean?",
            "Is coverage complete?",
            "Any visible defects?"
        ],
        "common_mistakes": [
            "showing only small section (hiding bad edges)",
            "different lighting to hide color issues",
            "extreme angles to hide drips"
        ],
        "required_evidence": [
            "full wall visible",
            "all corners visible",
            "edges clearly shown"
        ]
    },
    "acceptance_criteria": [...],
    "reference_analysis": {...}
}
```

### 2. Smart Contract Storage

```python
# Contract stores (TASK-004):
def create_job(client_addr, description, amount, paralegal_data):
    job_id = generate_id()

    storage.put(f"job_{job_id}", {
        "job_id": job_id,
        "client": client_addr,
        "description": description,
        "task": paralegal_data["data"]["task"],
        "location": paralegal_data["data"]["location"],
        "price_amount": amount,
        "reference_photos": ["ipfs://..."],
        "verification_plan": paralegal_data["verification_plan"],  # â† KEY!
        "acceptance_criteria": paralegal_data["acceptance_criteria"],
        "reference_analysis": paralegal_data["reference_analysis"],
        "status": "OPEN"
    })

    # Lock payment in escrow
    transfer_to_contract(client_addr, amount)

    return job_id
```

### 3. Worker Submits Proof

```python
# Worker uploads proof to IPFS
proof_url = upload_to_ipfs(proof_photo_bytes)

# Worker calls contract
contract.submit_proof(job_id, worker_addr, [proof_url])
```

### 4. Eye Agent Verification

```python
# Eye automatically fetches job data
result = await verify_work(
    proof_photos=["ipfs://Qm.../proof.jpg"],
    job_id="job_12345"
)

# Eye's internal process:
1. Fetches job from contract
2. Extracts verification_plan (generated by Paralegal)
3. Compares before/after photos
4. Verifies against plan:
   - Quality indicators checked
   - Checklist items validated
   - Required evidence confirmed
5. Makes decision

# Returns:
{
    "verified": True,
    "confidence": 0.95,
    "reason": "All requirements met. Work completed successfully.",
    "category": "APPROVED"
}
```

### 5. Smart Contract Payment Release

```python
# If approved (TASK-005):
if eye_result["verified"]:
    contract.release_funds(job_id, worker_addr)
    # Transfers payment from escrow to worker
    # Updates status to COMPLETED
else:
    # Payment stays in escrow
    # Worker can retry with better proof
    # Status remains PENDING
```

## ğŸ”— Key Integration Points

### Point 1: Paralegal Output â†’ Contract Input

**What Paralegal generates:**

```python
{
    "verification_plan": {...},      # For Eye agent
    "acceptance_criteria": [...],    # For display
    "reference_analysis": {...}      # For comparison
}
```

**How Contract stores it:**

```python
storage.put(f"job_{job_id}", {
    "verification_plan": paralegal_output["verification_plan"],
    # Stored permanently on-chain
    # Retrieved by Eye during verification
})
```

**Why this matters:**

- âœ… Generated once, used many times (cost efficient)
- âœ… Consistent verification for all workers
- âœ… Transparent requirements (workers see plan upfront)
- âœ… No "moving goalposts"

### Point 2: Contract Storage â†’ Eye Retrieval

**Eye fetches plan:**

```python
# In eye.py
def _get_job_data_placeholder(self, job_id: str) -> Dict:
    # TODO (TASK-004): Replace with actual contract call
    # return smart_contract.get_job(job_id)

    job_data = contract.storage.get(f"job_{job_id}")
    return job_data  # Contains verification_plan from Paralegal
```

**Eye uses plan:**

```python
verification_plan = job_data["verification_plan"]

# Eye checks each item in the plan
for indicator in verification_plan["quality_indicators"]:
    check_quality(proof, indicator)

for check in verification_plan["verification_checklist"]:
    validate_checkpoint(proof, check)
```

### Point 3: Data Structure Compatibility

**Both agents use the same structure:**

```python
# Paralegal generates:
verification_plan = {
    "task_category": str,
    "expected_transformation": {
        "before": str,
        "after": str
    },
    "quality_indicators": [str],
    "verification_checklist": [str],
    "common_mistakes": [str],
    "required_evidence": [str]
}

# Eye expects exactly this:
def verify_requirements(
    self,
    proof_photos: List[str],
    verification_plan: Dict  # â† Same structure!
):
    # Uses plan fields directly
    pass
```

## ğŸ§ª Testing the Integration

### Run the test:

```bash
cd agent
python integration_test.py
```

### Expected output:

```
ğŸ›¡ï¸  GIGSHIELD INTEGRATION TEST
====================================================================

ğŸ”„ INTEGRATION FLOW
[Shows flow diagram]

ğŸ§ª TEST CASE 1: Valid Job â†’ Good Work â†’ APPROVED
====================================================================
PHASE 1: JOB CREATION (CLIENT SIDE)
ğŸ“ Client submits job...
ğŸ¤– Calling Paralegal Agent...
âœ… Paralegal validation PASSED
ğŸ’¾ Job stored in smart contract...

PHASE 2: WORK VERIFICATION (WORKER SIDE)
ğŸ‘· Worker submits proof...
ğŸ‘ï¸  Calling Eye Agent...
âš–ï¸  VERIFICATION RESULT: APPROVED
ğŸ’° Smart Contract: RELEASING FUNDS TO WORKER

âœ… Integration test completed!
```

## ğŸ¯ Benefits of This Integration

### 1. Cost Efficiency

```
Traditional: AI call per verification
âŒ Worker 1 submits â†’ Generate plan â†’ Verify
âŒ Worker 2 submits â†’ Generate plan again â†’ Verify
âŒ Worker 3 submits â†’ Generate plan again â†’ Verify
ğŸ’¸ 3x AI generation costs!

GigShield: AI call once at job creation
âœ… Job posted â†’ Generate plan once â†’ Store
âœ… Worker 1 submits â†’ Use stored plan â†’ Verify
âœ… Worker 2 submits â†’ Use stored plan â†’ Verify
âœ… Worker 3 submits â†’ Use stored plan â†’ Verify
ğŸ’° 1x generation cost, reused for all!
```

### 2. Consistency

- Same verification criteria for all workers
- No variation in standards
- Fair evaluation for everyone

### 3. Transparency

- Workers see requirements before accepting
- No surprise rejections
- Clear expectations upfront

### 4. Automation

- No human intervention needed
- Instant verification
- Automatic payment release

### 5. Fraud Prevention

- Multi-layer verification
- Before/after comparison
- Location matching
- Quality assessment

## ğŸ“ Code Examples

### Example 1: Create Job (Frontend)

```python
from agent.paralegal import analyze_job_request
from services.storage import upload_to_ipfs

# Client uploads reference photo
reference_bytes = get_camera_input()
ref_url = upload_to_ipfs(reference_bytes)

# Paralegal validates
result = await analyze_job_request(
    text="Paint my wall blue at 123 Main St for 50 GAS",
    reference_image=reference_bytes
)

if result["status"] == "complete":
    # Store in smart contract
    job_id = contract.create_job(
        client_address,
        result["data"],
        result["verification_plan"],
        [ref_url]
    )

    st.success(f"Job created: {job_id}")
```

### Example 2: Submit Proof (Frontend)

```python
from services.storage import upload_to_ipfs
from agent.eye import verify_work

# Worker uploads proof
proof_bytes = get_camera_input()
proof_url = upload_to_ipfs(proof_bytes)

# Eye verifies
verdict = await verify_work(
    proof_photos=[proof_url],
    job_id=selected_job_id
)

if verdict["verified"]:
    st.balloons()
    st.success(f"âœ… APPROVED: {verdict['reason']}")
    # Contract automatically releases payment
else:
    st.error(f"âŒ REJECTED: {verdict['reason']}")
    # Worker can retry
```

## ğŸš€ Next Steps

1. **Implement Smart Contract** (TASK-004)

   - Replace placeholder storage with Neo N3 contract
   - Implement actual `get_job()` and `create_job()` functions

2. **Integrate with Frontend** (TASK-007-010)

   - Build UI for job creation
   - Show verification plan to workers
   - Display verification results

3. **Add Payment Logic** (TASK-005)

   - Implement `release_funds()` on contract
   - Add escrow mechanism
   - Handle failed verifications

4. **Enable Vision Models**
   - Fix vision API access
   - Re-enable image verification in Paralegal
   - Enhance reference photo analysis in Eye

## ğŸ“š Architecture Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT                               â”‚
â”‚                  (Posts job + photo)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PARALEGAL AGENT                           â”‚
â”‚   â€¢ Validates clarity                                       â”‚
â”‚   â€¢ Verifies image match                                    â”‚
â”‚   â€¢ Generates verification plan â† KEY OUTPUT                â”‚
â”‚   â€¢ Analyzes reference photo                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SMART CONTRACT                            â”‚
â”‚   â€¢ Stores verification plan                                â”‚
â”‚   â€¢ Holds payment in escrow                                 â”‚
â”‚   â€¢ Manages job lifecycle                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       WORKER                                â”‚
â”‚              (Completes work + submits proof)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EYE AGENT                              â”‚
â”‚   â€¢ Fetches verification plan from contract                 â”‚
â”‚   â€¢ Compares before/after photos                            â”‚
â”‚   â€¢ Verifies against plan criteria                          â”‚
â”‚   â€¢ Makes approval decision                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SMART CONTRACT                            â”‚
â”‚   â€¢ Releases payment if approved                            â”‚
â”‚   â€¢ Allows retry if rejected                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**The beauty of this system:** Paralegal defines the rules, Eye enforces them, and the Smart Contract automates payment. No human judgment needed! ğŸ¤–âœ¨
